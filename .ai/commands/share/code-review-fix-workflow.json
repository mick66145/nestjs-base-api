{
  "name": "Code Review ä¿®å¾©å·¥ä½œæµç¨‹",
  "description": "æ ¹æ“š Code Review çµæœï¼Œç³»çµ±åŒ–åœ°ä¿®å¾©ç™¼ç¾çš„å•é¡Œã€‚æ­¤æµç¨‹æ‡‰åœ¨ Code Review å·¥ä½œæµç¨‹ä¹‹å¾ŒåŸ·è¡Œã€‚",
  "prerequisites": [
    "å·²å®Œæˆ Code Review ä¸¦ç”¢ç”Ÿå ±å‘Š",
    "å·²è­˜åˆ¥æ‰€æœ‰éœ€è¦ä¿®å¾©çš„å•é¡Œ",
    "å·²é–±è®€é–‹ç™¼è¦ç¯„æ–‡ä»¶"
  ],
  "steps": [
    {
      "name": "å»ºç«‹å¾…è¾¦æ¸…å–®",
      "description": "ä½¿ç”¨ TodoWrite å·¥å…·å»ºç«‹æ‰€æœ‰éœ€è¦ä¿®å¾©çš„é …ç›®æ¸…å–®",
      "tasks": [
        "æ ¹æ“š Code Review å ±å‘Šï¼Œå°‡æ‰€æœ‰å•é¡Œè½‰æ›ç‚ºå¾…è¾¦äº‹é …",
        "æŒ‰å„ªå…ˆç´šæ’åºï¼šğŸš¨ åš´é‡éŒ¯èª¤ > âš ï¸ é•åè¦ç¯„ > âš ï¸ å…¶ä»–å•é¡Œ",
        "æ¯å€‹å¾…è¾¦äº‹é …æ‡‰åŒ…å«æ¸…æ™°çš„æè¿°å’Œå¯æ“ä½œçš„ç›®æ¨™"
      ],
      "example": [
        "ä¿®å¾© service.ts create æ–¹æ³•ä¸­é—œè¯è³‡æº ID äº’æ›éŒ¯èª¤",
        "ä¿®å¾© service.ts update æ–¹æ³•ä¸­é—œè¯è³‡æº ID äº’æ›éŒ¯èª¤",
        "åœ¨ find-all-query.dto.ts æ–°å¢ orderBy å’Œ ids åƒæ•¸",
        "ä¿®å¾© service.ts å¯¦ä½œå‹•æ…‹æ’åºåŠŸèƒ½"
      ]
    },
    {
      "name": "ä¿®å¾©åš´é‡éŒ¯èª¤",
      "description": "å„ªå…ˆè™•ç†æ‰€æœ‰ ğŸš¨ æ¨™è¨˜çš„åš´é‡éŒ¯èª¤",
      "priority": "HIGH",
      "common_fixes": [
        {
          "issue": "é—œè¯è³‡æº ID äº’æ›éŒ¯èª¤",
          "pattern": "è®Šæ•¸åç¨±èˆ‡å¯¦éš›ä½¿ç”¨çš„ ID ä¸ä¸€è‡´",
          "fix_steps": [
            "æ‰¾åˆ°éŒ¯èª¤çš„ connect èªå¥",
            "ç¢ºèªæ­£ç¢ºçš„è®Šæ•¸åç¨±å’Œ ID å°æ‡‰é—œä¿‚",
            "ä½¿ç”¨ Edit å·¥å…·ä¿®æ­£",
            "æ›´æ–°å¾…è¾¦æ¸…å–®ç‹€æ…‹ç‚º completed"
          ],
          "example": {
            "wrong": "propertyUsageZone: { connect: { id: propertyUsageCategory.id } }",
            "correct": "propertyUsageZone: { connect: { id: propertyUsageZone.id } }"
          }
        },
        {
          "issue": "è³‡æ–™åº«æ“ä½œé‚è¼¯éŒ¯èª¤",
          "pattern": "where æ¢ä»¶ã€join é—œä¿‚ã€transaction ç¯„åœç­‰é‚è¼¯éŒ¯èª¤",
          "fix_steps": [
            "ä»”ç´°æª¢æŸ¥è³‡æ–™åº«æ“ä½œé‚è¼¯",
            "å°ç…§ Prisma schema ç¢ºèªé—œä¿‚å®šç¾©",
            "ä¿®æ­£éŒ¯èª¤çš„é‚è¼¯",
            "æ›´æ–°å¾…è¾¦æ¸…å–®"
          ]
        }
      ]
    },
    {
      "name": "ä¿®å¾©é•åé–‹ç™¼è¦ç¯„çš„å•é¡Œ",
      "description": "è™•ç†æ‰€æœ‰ âš ï¸ æ¨™è¨˜çš„è¦ç¯„é•åå•é¡Œ",
      "priority": "MEDIUM",
      "categories": [
        {
          "category": "Query DTO è¦ç¯„",
          "fixes": [
            {
              "issue": "ç¼ºå°‘ orderBy åƒæ•¸",
              "fix_steps": [
                "åœ¨ Query DTO ä¸­æ–°å¢ orderBy åƒæ•¸",
                "ä½¿ç”¨ @ApiPropertyOptional è£é£¾å™¨",
                "æ·»åŠ  example å’Œ description",
                "ä½¿ç”¨ @IsOptional å’Œ @IsString é©—è­‰å™¨"
              ],
              "code_template": "@ApiPropertyOptional({\n  example: 'id:desc',\n  description: 'æ’åº; æ¬„ä½:desc|ascï¼Œå…©å€‹æ¬„ä½ä»¥ä¸Šç”¨,åˆ†éš”',\n})\n@IsOptional()\n@IsString()\norderBy?: string;"
            },
            {
              "issue": "ç¼ºå°‘ ids åƒæ•¸",
              "fix_steps": [
                "å°å…¥ IntIdsQuery è£é£¾å™¨å’Œ entityName",
                "åœ¨ Query DTO ä¸­æ–°å¢ ids åƒæ•¸",
                "ä½¿ç”¨ @IntIdsQuery(entityName) è£é£¾å™¨"
              ],
              "code_template": "import { IntIdsQuery } from 'src/_libs/api-request/query.decorator';\nimport { entityName } from '../æ¨¡çµ„åç¨±.interface';\n\n@IntIdsQuery(entityName)\nids?: number[];"
            },
            {
              "issue": "Enum æ¬„ä½ example å€¼ä¸ç¬¦è¦ç¯„",
              "fix_steps": [
                "æ‰¾åˆ°æ‰€æœ‰ Enum é¡å‹çš„ @ApiPropertyOptional",
                "å°‡ example å€¼æ”¹ç‚º nullï¼ˆé™¤éæœ‰ç‰¹å®šéœ€æ±‚ï¼‰"
              ],
              "code_template": "@ApiPropertyOptional({\n  description: 'ç‹€æ…‹ç¯©é¸',\n  enum: StatusEnum,\n  example: null, // æ”¹ç‚º null\n})"
            }
          ]
        },
        {
          "category": "Service è¦ç¯„",
          "fixes": [
            {
              "issue": "æœªå¯¦ä½œå‹•æ…‹æ’åº",
              "fix_steps": [
                "å°å…¥ $PrismaOrderByInput",
                "åœ¨ findAll æ–¹æ³•ä¸­è§£æ§‹ orderBy åƒæ•¸",
                "ä½¿ç”¨ queryOrderBy æ–¹æ³•è™•ç†",
                "åœ¨ pagination æŸ¥è©¢ä¸­ä½¿ç”¨ defaultOrderBy"
              ],
              "code_template": "import { $PrismaOrderByInput } from 'src/libs/prisma/order-by-input';\n\nconst { orderBy } = query;\nconst defaultOrderBy: Prisma.ModelOrderByWithRelationInput[] =\n  orderBy !== undefined\n    ? $PrismaOrderByInput.queryOrderBy<Prisma.ModelOrderByWithRelationInput>(orderBy)\n    : [{ id: 'desc' }];\n\nconst { result, ...meta } = await this.prisma.model.pagination({\n  orderBy: defaultOrderBy,\n  ...\n});"
            },
            {
              "issue": "æœªä½¿ç”¨è¦ç¯„çš„é—œéµå­—æœå°‹å·¥å…·å‡½æ•¸",
              "fix_steps": [
                "å°å…¥ $PrismaWhereInput",
                "ä½¿ç”¨ whereKeywordInput æ–¹æ³•å»ºç«‹æœå°‹æ¢ä»¶",
                "ä½¿ç”¨ mergeWhereInput æ–¹æ³•åˆä½µæ¢ä»¶"
              ],
              "code_template": "import { $PrismaWhereInput } from 'src/libs/prisma/where-input';\n\nconst whereOR: Prisma.ModelWhereInput[] = [];\nif (keyword?.length) {\n  const keywordWhere = $PrismaWhereInput.whereKeywordInput<Prisma.ModelWhereInput>(\n    ['field1', 'field2', 'field3'],\n    keyword,\n  );\n  $PrismaWhereInput.mergeWhereInput(whereOR, {\n    OR: [...keywordWhere],\n  });\n}\nif (whereOR.length) where.OR = whereOR;"
            },
            {
              "issue": "æœªæ”¯æ´ IDs ç¯©é¸",
              "fix_steps": [
                "åœ¨ findAll æ–¹æ³•ä¸­è§£æ§‹ ids åƒæ•¸",
                "æ·»åŠ  ids ç¯©é¸é‚è¼¯ï¼šif (ids?.length) where.id = { in: ids };"
              ]
            }
          ]
        },
        {
          "category": "DTO è¦ç¯„",
          "fixes": [
            {
              "issue": "ç¼ºå°‘ description",
              "fix_steps": [
                "æ‰¾åˆ°ç¼ºå°‘ description çš„ @ApiProperty/@ApiPropertyOptional",
                "æ·»åŠ é©ç•¶çš„ä¸­æ–‡æè¿°"
              ],
              "code_template": "@ApiProperty({\n  description: 'æ¬„ä½æè¿°',\n  type: DtoClass,\n})"
            }
          ]
        }
      ]
    },
    {
      "name": "ä¿®å¾©å…¶ä»–å•é¡Œ",
      "description": "è™•ç†å»ºè­°æ”¹å–„çš„å•é¡Œ",
      "priority": "LOW",
      "common_fixes": [
        {
          "issue": "è¨»é‡‹é¢¨æ ¼ä¸ä¸€è‡´",
          "fix": "çµ±ä¸€ä½¿ç”¨ JSDoc /** */ é¢¨æ ¼"
        },
        {
          "issue": "ç¼ºå°‘ JSDoc è¨»é‡‹",
          "fix": "ç‚ºå…¬é–‹æ–¹æ³•æ·»åŠ  JSDoc è¨»é‡‹"
        },
        {
          "issue": "Nullable æ¬„ä½å®šç¾©ä¸æ˜ç¢º",
          "fix": "ç¢ºèª Prisma schema ä¸¦æ­£ç¢ºæ¨™è¨» nullable æ¬„ä½"
        }
      ]
    },
    {
      "name": "é©—è­‰ä¿®å¾©çµæœ",
      "description": "ç¢ºèªæ‰€æœ‰ä¿®å¾©éƒ½æ­£ç¢ºä¸”ç¬¦åˆè¦ç¯„",
      "tasks": [
        "æª¢æŸ¥æ‰€æœ‰å¾…è¾¦äº‹é …éƒ½å·²æ¨™è¨˜ç‚º completed",
        "ç¢ºèªä¿®æ”¹çš„æª”æ¡ˆç¬¦åˆç¨‹å¼ç¢¼é¢¨æ ¼è¦ç¯„",
        "ç¢ºèªæ²’æœ‰å¼•å…¥æ–°çš„éŒ¯èª¤",
        "å¦‚æœ‰æ¸¬è©¦ï¼ŒåŸ·è¡Œç›¸é—œæ¸¬è©¦ç¢ºä¿åŠŸèƒ½æ­£å¸¸"
      ]
    },
    {
      "name": "ç”¢ç”Ÿä¿®å¾©å ±å‘Š",
      "description": "ç¸½çµä¿®å¾©å…§å®¹ä¸¦æä¾›æ¸…å–®",
      "format": {
        "sections": [
          {
            "title": "âœ… æ‰€æœ‰ä¿®å¾©å®Œæˆ",
            "content": "ç¸½çµå®Œæˆçš„ä¿®å¾©å·¥ä½œ"
          },
          {
            "title": "ğŸš¨ åš´é‡éŒ¯èª¤ï¼ˆå·²ä¿®å¾©ï¼‰",
            "content": "åˆ—å‡ºä¿®å¾©çš„åš´é‡éŒ¯èª¤ï¼ŒåŒ…å«æª”æ¡ˆä½ç½®å’Œä¿®å¾©èªªæ˜"
          },
          {
            "title": "âš ï¸ é•åé–‹ç™¼è¦ç¯„ï¼ˆå·²ä¿®å¾©ï¼‰",
            "content": "åˆ—å‡ºä¿®å¾©çš„è¦ç¯„é•åå•é¡Œ"
          },
          {
            "title": "âš ï¸ å…¶ä»–å•é¡Œï¼ˆå·²ä¿®å¾©ï¼‰",
            "content": "åˆ—å‡ºä¿®å¾©çš„å…¶ä»–å•é¡Œ"
          },
          {
            "title": "ğŸ“ ä¿®æ”¹æª”æ¡ˆæ¸…å–®",
            "content": "åˆ—å‡ºæ‰€æœ‰è¢«ä¿®æ”¹çš„æª”æ¡ˆåŠå…¶ä¿®æ”¹å…§å®¹"
          }
        ]
      }
    }
  ],
  "common_patterns": {
    "é—œè¯è³‡æº ID éŒ¯èª¤": {
      "description": "è®Šæ•¸åç¨±èˆ‡å¯¦éš›ä½¿ç”¨çš„ ID ä¸ä¸€è‡´",
      "detection": "æª¢æŸ¥ connect: { id: xxx } ä¸­çš„ xxx æ˜¯å¦èˆ‡è®Šæ•¸åç¨±ä¸€è‡´",
      "fix": "ç¢ºä¿ä½¿ç”¨æ­£ç¢ºçš„è®Šæ•¸åç¨±å°æ‡‰çš„ id"
    },
    "å‹•æ…‹æ’åºæœªå¯¦ä½œ": {
      "description": "å¯«æ­» orderBy è€Œéä½¿ç”¨å‹•æ…‹æ’åº",
      "detection": "æŸ¥çœ‹ pagination ä¸­çš„ orderBy æ˜¯å¦ç‚ºå›ºå®šå€¼",
      "fix": "å°å…¥ $PrismaOrderByInput ä¸¦ä½¿ç”¨ queryOrderBy æ–¹æ³•"
    },
    "é—œéµå­—æœå°‹æœªä½¿ç”¨å·¥å…·å‡½æ•¸": {
      "description": "æ‰‹å‹•æ§‹å»º contains æŸ¥è©¢è€Œéä½¿ç”¨å·¥å…·å‡½æ•¸",
      "detection": "æŸ¥çœ‹æ˜¯å¦æœ‰æ‰‹å‹• push å¤šå€‹ contains æ¢ä»¶",
      "fix": "ä½¿ç”¨ $PrismaWhereInput.whereKeywordInput æ–¹æ³•"
    },
    "Query DTO ç¼ºå°‘æ¨™æº–åƒæ•¸": {
      "description": "ç¼ºå°‘ orderBy æˆ– ids åƒæ•¸",
      "detection": "æª¢æŸ¥ Query DTO æ˜¯å¦ç¹¼æ‰¿ PaginationQueryDto ä¸¦åŒ…å«æ¨™æº–åƒæ•¸",
      "fix": "æ·»åŠ  @IntIdsQuery å’Œ orderBy åƒæ•¸"
    }
  },
  "best_practices": [
    "æ¯æ¬¡ä¿®å¾©å¾Œç«‹å³æ›´æ–°å¾…è¾¦æ¸…å–®ç‹€æ…‹",
    "ä½¿ç”¨ Edit å·¥å…·è€Œé Write å·¥å…·ä¿®æ”¹ç¾æœ‰æª”æ¡ˆ",
    "ä¿æŒä¿®æ”¹çš„æœ€å°åŒ–ï¼Œåªä¿®å¾©å¿…è¦çš„å•é¡Œ",
    "ç¢ºä¿ä¿®æ”¹å¾Œçš„ç¨‹å¼ç¢¼ç¬¦åˆå°ˆæ¡ˆçš„æ ¼å¼åŒ–è¦ç¯„ï¼ˆ2 ç©ºæ ¼ã€å–®å¼•è™Ÿç­‰ï¼‰",
    "å°æ–¼è¤‡é›œçš„ä¿®å¾©ï¼Œå…ˆä¿®å¾©åš´é‡éŒ¯èª¤å†è™•ç†è¦ç¯„å•é¡Œ",
    "ä¿®å¾©å®Œæˆå¾Œæä¾›æ¸…æ™°çš„ç¸½çµå ±å‘Š"
  ],
  "notes": [
    "æ­¤å·¥ä½œæµç¨‹æ‡‰è©²åœ¨ code-review-workflow.json ä¹‹å¾ŒåŸ·è¡Œ",
    "ä¿®å¾©éç¨‹ä¸­æ‡‰åš´æ ¼éµå¾ª docs/code-style-guide.md çš„è¦ç¯„",
    "å¦‚æœé‡åˆ°ä¸ç¢ºå®šçš„å•é¡Œï¼Œæ‡‰è©¢å•ä½¿ç”¨è€…è€Œéè‡ªè¡Œæ±ºå®š",
    "æ‰€æœ‰ä¿®å¾©éƒ½æ‡‰è©²æœ‰æ˜ç¢ºçš„ç†ç”±å’Œè¦ç¯„ä¾æ“š",
    "ä¿®å¾©å®Œæˆå¾Œæ‡‰ç”¢ç”Ÿçµæ§‹åŒ–çš„å ±å‘Šè®“ä½¿ç”¨è€…äº†è§£æ‰€æœ‰è®Šæ›´"
  ]
}
