{
  "name": "現有功能文件撰寫流程",
  "description": "根據現有功能模組分析並撰寫 SA (系統分析) 和 SD (系統設計) 文件。",
  "steps": [
    {
      "name": "讀取規範",
      "run": [
        "cat ./docs/development-guidelines.md",
        "cat ./docs/code-style-guide.md",
        "cat ./docs/testing-guidelines.md",
        "cat ./docs/sa-documentation-style-guide.md",
        "cat ./docs/sd-documentation-style-guide.md"
      ]
    },
    {
      "name": "選擇功能模組",
      "description": "列出現有功能模組供用戶選擇",
      "tasks": [
        "列出所有 src 目錄下的功能模組（*.module.ts）",
        "展示模組清單給用戶",
        "讓用戶選擇要撰寫文件的功能模組",
        "確認用戶選擇的模組名稱"
      ]
    },
    {
      "name": "檢查文件是否已存在",
      "description": "檢查選定的功能模組是否已有文件，自動決定是新增或更新模式。",
      "tasks": [
        "檢查 `docs/features/{模組名稱}/` 目錄是否存在",
        "檢查是否已有 SA 文件（{模組名稱}-sa.md）",
        "檢查是否已有 SD 文件（{模組名稱}-sd.md）",
        "如果文件已存在（SA 或 SD 其中之一或兩者都存在）：",
        "  - 明確告知用戶該模組已有文件，將進入更新模式",
        "  - 顯示現有文件的路徑",
        "  - 讀取現有的 SA 文件內容（如果存在）",
        "  - 讀取現有的 SD 文件內容（如果存在）",
        "  - 設定工作模式為「更新模式」",
        "  - 告知用戶後續步驟將會基於現有文件進行更新而非新增",
        "如果文件不存在：",
        "  - 告知用戶這是新文件撰寫，將進入新增模式",
        "  - 設定工作模式為「新增模式」",
        "繼續執行下一步"
      ]
    },
    {
      "name": "功能模組分析",
      "description": "深入分析選定的功能模組，扮演資深後端工程師、SA和SD等多個角色，全面理解功能實作細節。",
      "tasks": [
        "讀取並分析功能模組的主要檔案（module.ts, controller.ts, service.ts, dto, entity等）",
        "分析 API 端點（路由、HTTP 方法、請求/回應格式）",
        "分析資料庫結構（Entity、Schema、關聯性）",
        "分析業務邏輯（Service 層的核心功能）",
        "識別第三方服務整合（如有）",
        "分析錯誤處理機制",
        "查看相關測試檔案（如有）",
        "自己扮演資深後端工程師、SA（系統分析師）和SD（系統設計師）等多個角色",
        "各角色基於代碼分析結果，自問自答以下問題：",
        "  - 這個功能的核心業務價值是什麼？",
        "  - 主要使用情境有哪些？",
        "  - 資料流向如何運作？",
        "  - 有哪些關鍵的業務規則和限制？",
        "  - 系統如何處理異常情況？",
        "整理分析結果，包含：",
        "  - 功能概述與核心目標",
        "  - 主要使用情境",
        "  - API 清單與規格",
        "  - 資料模型與關聯",
        "  - 業務流程與規則",
        "  - 錯誤處理策略",
        "向用戶展示分析結果摘要",
        "詢問用戶是否有需要補充或修正的部分",
        "等待用戶確認後，才進入下一步文件撰寫階段"
      ]
    },
    {
      "name": "撰寫 SA 系統分析文件",
      "description": "根據功能模組分析結果和工作模式（新增或更新），撰寫或更新 SA 文件。",
      "tasks": [
        "根據工作模式執行相應操作：",
        "  - 新增模式：撰寫全新的 SA 系統分析文件",
        "  - 更新模式：基於現有 SA 文件內容進行更新和補充",
        "參考 ./docs/sa-documentation-style-guide.md",
        "文件應包含以下章節：",
        "  1. 文件頭部資訊（版本、日期、文件類型）",
        "  2. 目錄",
        "  3. 功能概述",
        "  4. 使用情境範例（User Stories）",
        "  5. 系統流程圖（使用標準 ASCII 符號）",
        "  6. 時序圖（Sequence Diagram）",
        "  7. 事件流程說明",
        "  8. 業務規則與限制",
        "  9. 資料流向",
        "  10. 使用者介面需求（如適用）",
        "  11. 非功能性需求",
        "  12. 版本歷史",
        "確保流程圖和時序圖清晰易懂",
        "所有業務情境都有完整說明",
        "將 SA 文件儲存在 `docs/features/模組名稱/` 目錄下，檔名格式：{模組名稱}-sa.md"
      ]
    },
    {
      "name": "撰寫 SD 系統設計文件",
      "description": "根據功能模組分析結果和工作模式（新增或更新），撰寫或更新 SD 文件。",
      "tasks": [
        "根據工作模式執行相應操作：",
        "  - 新增模式：撰寫全新的 SD 系統設計文件",
        "  - 更新模式：基於現有 SD 文件內容進行更新和補充",
        "參考 ./docs/sd-documentation-style-guide.md",
        "文件應包含以下章節：",
        "  1. 文件頭部資訊（版本、日期、文件類型）",
        "  2. 目錄",
        "  3. 系統架構概述",
        "  4. API 文件規範",
        "     - 端點清單",
        "     - 請求/回應格式",
        "     - 狀態碼定義",
        "     - 錯誤回應格式",
        "  5. 資料結構定義",
        "     - Entity/Model 定義",
        "     - DTO 定義",
        "     - 資料庫 Schema",
        "     - 資料關聯圖",
        "  6. 業務邏輯設計",
        "     - Service 層設計",
        "     - 核心演算法說明",
        "  7. 錯誤處理機制",
        "  8. 安全性設計（驗證、授權）",
        "  9. 第三方服務整合（如有）",
        "  10. 效能考量",
        "  11. 範例代碼",
        "  12. 版本歷史",
        "所有代碼範例使用 TypeScript JSDoc 風格註釋 (/** */)",
        "確保 API 文件包含完整的欄位說明表格",
        "資料結構定義清晰，包含型別和說明",
        "將 SD 文件儲存在 `docs/features/模組名稱/` 目錄下，檔名格式：{模組名稱}-sd.md"
      ]
    },
    {
      "name": "文件審查與完善",
      "description": "檢查文件完整性並進行最後修飾。",
      "tasks": [
        "檢查 SA 和 SD 文件是否涵蓋所有必要章節",
        "確認所有表格格式正確",
        "確認所有代碼範例可讀且有註釋",
        "確認流程圖和時序圖格式正確",
        "檢查文件間的一致性（SA 和 SD 描述是否對應）",
        "更新版本歷史表格",
        "向用戶展示文件路徑和內容摘要",
        "詢問用戶是否需要調整或補充"
      ]
    }
  ]
}
